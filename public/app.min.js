let keySize, iterations, password, appVersion, darkMode = localStorage.getItem("darkMode"); const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)"), btn = document.getElementById("btn"), url = "https://moka-chat.herokuapp.com/", maxSize = 819200..toString(), sizeFile = getSize(maxSize), socket = io.connect(url, { transport: ["websocket"], secure: !0 }); let currentStream, closeVideo, takeSnap, videoRecorder, closeVideoFromStream, toSendPhoto, toSendVideo, toMakeGif, toRunMe, toSendGif, tempData, cameraArr, cameraRotate, cName = "", count = 1, moreThanOne = !1, toRemoveCameraIcon = !1, myRecorder = { objects: { context: null, stream: null, recorder: null } }; function init() { if (1 === count) return cName = document.getElementById("msg").value, socket.emit("new-user", cName), $("#msg").attr("placeholder", "Message"), count += 1, $("#msg").val(""); let e = document.getElementById("msg").value.toString().toLowerCase(); if (2 === count && "" !== e) { if (e.match(/sticker/i)) return socket.emit("chat", { message: e, handle: cName }), $("#msg").val(""); if (e.match(/gif/i)) return socket.emit("chat", { message: e, handle: cName }), $("#msg").val(""); if ("lightmode" === e) return lightm(), $("#msg").val(""); if ("darkmode" === e) return darkm(), $("#msg").val(""); if ("file2upload" === e) return file2Upload(), $("#msg").val(""); if ("cleartext" === e) return $("#send").empty(), $("#msg").val(""); if ("whoami" === e.split(" ").join("")) return alert("secondary", "This is public chat room"); if ("appversion" === e.split(" ").join("")) return alert("secondary", `App Version = ${appVersion}`); if ("opencamera" === e.split(" ").join("") && !1 === toRemoveCameraIcon) return openCamera(), $("#msg").val(""); if ("audiorecorderstart" === e.split(" ").join("")) return audioStart(), $("#msg").val(""); if ("shownew" === e.split(" ").join("")) return socket.emit("showNewfeature"), $("#msg").val(""); var t = encrypt(validator.escape(e), password); socket.emit("chat", { message: t, handle: cName }); $("#msg").val("") } } function encrypt(e, t) { var n = CryptoJS.lib.WordArray.random(16), o = CryptoJS.PBKDF2(t, n, { keySize: keySize / 32, iterations: iterations }), a = CryptoJS.lib.WordArray.random(16), i = CryptoJS.AES.encrypt(e, o, { iv: a, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }); return n.toString() + a.toString() + i.toString() } function decrypt(e, t) { var n = CryptoJS.enc.Hex.parse(e.substr(0, 32)), o = CryptoJS.enc.Hex.parse(e.substr(32, 32)), a = e.substring(64), i = CryptoJS.PBKDF2(t, n, { keySize: keySize / 32, iterations: iterations }); return CryptoJS.AES.decrypt(a, i, { iv: o, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC }) } function firstName(e) { let t = e === cName ? "you" : e; return t.charAt(0).toUpperCase() + t.slice(1) } function makeBlob(e, t) { let n = b64toBlob(e, t); return (window.URL || window.webkitURL).createObjectURL(n) } function lightm() { localStorage.setItem("darkMode", "Light"), darkMode = localStorage.getItem("darkMode"), document.documentElement.setAttribute("data-theme", darkMode), trans() } function darkm() { localStorage.setItem("darkMode", "Dark"), darkMode = localStorage.getItem("darkMode"), document.documentElement.setAttribute("data-theme", darkMode), trans() } function trans() { document.documentElement.classList.add("transition"), window.setTimeout(() => { document.documentElement.classList.remove("transition") }, 1e3) } function file2Upload() { $("#sendfile").click() } function basic_init(e) { if (toRemoveCameraIcon) { const t = e.indexOf("Open Camera"); t > -1 && e.splice(t, 1) } e.forEach(e => { const t = document.createElement("li"), n = document.createElement("a"); n.setAttribute("class", "text"), n.innerText = e, t.appendChild(n), document.getElementById("myUL").appendChild(t) }) } function bye() { $("#myUL").fadeOut() } function myFunction() { var e, t, n, o, a; e = document.getElementById("msg"); var i = document.getElementById("myUL"); if ((t = e.value.toUpperCase()).length >= 3) for (i.style.display = "block", i.children[0].style.display = "block", n = document.getElementById("myUL").getElementsByTagName("li"), a = 0; a < n.length; a++)((o = n[a].getElementsByTagName("a")[0]).textContent || o.innerText).toUpperCase().indexOf(t) > -1 ? n[a].style.display = "" : n[a].style.display = "none"; else $("#myUL").fadeOut() } function initStart() { null === myRecorder.objects.context && (myRecorder.objects.context = new (window.AudioContext || window.webkitAudioContext)) } function audioStart() { initStart(); navigator.mediaDevices.getUserMedia({ audio: !0, video: !1 }).then(function (e) { myRecorder.objects.stream = e, myRecorder.objects.recorder = new Recorder(myRecorder.objects.context.createMediaStreamSource(e), { numChannels: 1 }), myRecorder.objects.recorder.record(), AudioRecorderTimer() }).catch(function (e) { }) } function audioStop() { null !== myRecorder.objects.stream && myRecorder.objects.stream.getAudioTracks()[0].stop(), null !== myRecorder.objects.recorder && (myRecorder.objects.recorder.stop(), makeAudioFile(myRecorder)) } function makeAudioFile(e) { var t = document.createElement("div"); t.setAttribute("id", "audio"), $("#audioTemp").append(t); var n = $("#audio"); null !== n && "object" == typeof n && n.length > 0 && e.objects.recorder.exportWAV(function (t) { let n = t.size; Number(maxSize) > n ? (socket.emit("blob", { blob: t, handle: cName, type: t.type, sending: "audio" }), $("#audioTemp").empty(), alert("success", "Audio is sent"), stopMediaTracks(e.objects.stream), myRecorder = { objects: { context: null, stream: null, recorder: null } }) : alert("danger", "Audio recorder less than 5 sec") }) } function AudioRecorderTimer() { let e = 5, t = setInterval(() => { if ((e -= 1) < 0) return clearInterval(t), audioStop(), $("#msg").val(""); $("#msg").val(e) }, 900) } function alert(e, t) { return $("#alert").fadeIn(), $("#alert").html(`<div class="alert alert-${e}" role="alert">${t}</div>`), setTimeout(() => { $("#alert").fadeOut(1e3).empty() }, 5e3) } function showNotificationCount(e) { const t = /^\(\d+\)/; 0 === e || t.test(document.title) ? document.title = document.title.replace(t, 0 === e ? "" : `(${e})`) : document.title = `(${e})` } function getSize(e) { if (7 === e.length) { return `${`${e.charAt(0)}`}mb` } if (8 === e.length) { return `${e.substring(0, 2)}mb` } if (9 === e.length) { return `${e.substring(0, 3)}mb` } if (6 === e.length) { return `${e.substring(0, 3)}kb` } if (5 === e.length) { return `${e.substring(0, 2)}kb` } if (4 === e.length) { return `${e.substring(0, 1)}kb` } } function gotDevices(e) { let t = []; return e.forEach(e => { if ("videoinput" === e.kind) { let n = { label: e.label, deviceId: e.deviceId }; t.push(n) } }), t } function stopMediaTracks(e) { e.getTracks().forEach(e => { e.stop() }) } function openCamera() { const e = document.getElementById("forVideoGrid"), t = document.createElement("video"); t.muted = !0; let n = $("#deviceId").val() || ""; void 0 !== currentStream && stopMediaTracks(currentStream); const o = {}; "" === n ? o.facingMode = "environment" : o.deviceId = { exact: n }; const a = { video: o, audio: !0 }; navigator.mediaDevices.getUserMedia(a).then(n => (currentStream = n, addVideoStream(t, n, e), navigator.mediaDevices.enumerateDevices())).then(gotDevices).catch(e => { alert("danger", `${e}`) }) } function addVideoStream(e, t, n) { e.srcObject = t, e.setAttribute("id", "streamVideo"), e.addEventListener("loadedmetadata", () => { e.play() }); let o = document.createElement("div"); o.innerHTML = '<div class="option_controls">\n  <div class="options" >\n    <i class="fas fa-times" id="closeVideo"></i>\n  </div>\n  <div class="options" id="takeSnap">\n    <i class="far fa-image"></i>\n  </div>\n  <div class="options" id="videoRecorder">\n    <i class="fas fa-video"></i>\n  </div>\n</div>', n.append(e), n.append(o), closeVideo = document.getElementById("closeVideo"), takeSnap = document.getElementById("takeSnap"), videoRecorder = document.getElementById("videoRecorder"), basicCall() } function checkList(e) { return 1 === e.length ? $("#deviceId").val(e[0].deviceId) : 2 === e.length ? moreThanOneCamera(e) : void 0 } function moreThanOneCamera(e) { toRemoveCameraIcon = !0; let t = document.createElement("div"); t.setAttribute("class", "forSvgs"); return t.innerHTML = '\n  <svg fill="currentColor" id="rotate" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512"  xml:space="preserve">\n    <path d="M451.267,144.067h-92.16c-2.56,0-5.12-1.707-5.12-3.413l-9.387-29.867c-3.413-11.093-13.653-17.92-24.747-17.92H191\n      c-11.947,0-21.333,6.827-24.747,17.92l-9.387,29.867c-1.707,1.707-3.413,3.413-5.973,3.413h-92.16\n      C25.453,144.067-1,170.52-1,203.8v153.6c0,33.28,26.453,59.733,59.733,59.733h392.533c33.28,0,59.733-26.453,59.733-59.733V203.8\n      C511,170.52,484.547,144.067,451.267,144.067z M493.933,357.4c0,23.893-18.773,42.667-42.667,42.667H58.733\n      c-23.893,0-42.667-18.773-42.667-42.667V203.8c0-23.893,18.773-42.667,42.667-42.667h92.16c10.24,0,17.92-5.973,22.187-15.36\n      l9.387-29.867c1.707-3.413,5.12-5.973,8.533-5.973h128c4.267,0,7.68,2.56,8.533,5.973l10.24,30.72\n      c3.413,8.533,11.947,14.507,21.333,14.507h92.16c23.893,0,42.667,18.773,42.667,42.667V357.4z"/>\n    <path d="M297.667,333.507c-11.947,10.24-27.307,15.36-42.667,15.36c-37.547,0-68.267-30.72-68.267-68.267v-5.12l2.56,2.56\n      c1.707,1.707,3.413,2.56,5.973,2.56s4.267-0.853,5.973-2.56c3.413-3.413,3.413-8.533,0-11.947l-15.607-15.606\n      c-1.395-2.509-4.034-4.02-7.434-4.02s-6.038,1.511-7.434,4.02l-15.606,15.606c-3.413,3.413-3.413,8.533,0,11.947\n      s8.533,3.413,11.947,0l2.56-2.56v5.12c0,46.933,38.4,85.333,85.333,85.333c19.627,0,38.4-6.827,53.76-19.627\n      c3.413-2.56,3.413-8.533,0.853-11.947S301.08,330.947,297.667,333.507z"/>\n    <path d="M342.893,266.093l-3.419,3.419c-5.855-41.331-41.594-73.392-84.475-73.392c-19.627,0-38.4,6.827-53.76,18.773\n      c-3.413,2.56-3.413,8.533-0.853,11.947c2.56,3.413,8.533,3.413,11.947,0.853c11.947-10.24,26.453-15.36,42.667-15.36\n      c33.013,0,60.738,23.752,66.955,55.009l-1.249-1.249c-3.413-3.413-8.533-3.413-11.947,0s-3.413,8.533,0,11.947l15.607,15.607\n      c1.395,2.509,4.034,4.02,7.433,4.02c3.676,0,6.463-1.764,7.748-4.335l15.292-15.292c3.413-3.413,3.413-8.533,0-11.947\n      S346.307,262.68,342.893,266.093z"/>\n</svg>\n  ', $(".addCameraAdd").append(t), moreThanOne = !0, cameraArr = e, cameraRotate = document.getElementById("rotate"), forCamerafuc() } function closeVideofuc() { return closeVideo = takeSnap = videoRecorder = null, stopMediaTracks(currentStream), $("#forVideoGrid").empty() } function takeSnapfuc() { let e = document.getElementById("streamVideo"); $("#forVideoGrid").empty(); const t = document.createElement("canvas"), n = document.createElement("img"); n.setAttribute("id", "canvasImage"); let o = height = 480; var a = t.getContext("2d"); t.width = o, t.height = height, a.drawImage(e, 0, 0, o, height); var i = t.toDataURL("image/jpeg"); tempData = i; let r = makeDiv("toSendPhoto"); return n.setAttribute("src", i), $("#forVideoGrid").append(n), $("#forVideoGrid").append(r), closeVideoFromStream = document.getElementById("closeVideoFromStream"), toSendPhoto = document.getElementById("toSendPhoto"), basicCallfucTwo() } function videoRecorderfuc() { $("#videoRecorder").addClass("addRecorderColor"); let e = [], t = new MediaRecorder(currentStream); $("#takeSnap,#closeVideo").fadeOut(), t.start(), function () { let e = 5, n = setInterval(() => { if ((e -= 1) < 0) return clearInterval(n), function (e) { t.stop(), $("#takeSnap,#closeVideo").fadeIn() }(), $("#msg").val(""), $("#videoRecorder").removeClass("addRecorderColor"); $("#msg").val(e) }, 850) }(), t.ondataavailable = function (t) { e.push(t.data) }, t.onstop = (() => { stopMediaTracks(currentStream), $("#forVideoGrid").empty(); let t = new Blob(e, { type: "video/ogg" }); if (Number(maxSize) > t.size) { e = [], tempData = t; let n = document.createElement("video"), o = (window.URL || window.webkitURL).createObjectURL(t); n.src = o; let a = makeDivForGif("toSendVideo", "toMakeGif"); return n.setAttribute("class", "recorderVideoStream"), n.setAttribute("controls", "controls"), $("#forVideoGrid").append(n), $("#forVideoGrid").append(a), closeVideoFromStream = document.getElementById("closeVideoFromStream"), toSendVideo = document.getElementById("toSendVideo"), toMakeGif = document.getElementById("toMakeGif"), basicCallfucTwo() } alert("danger", `File less then ${sizeFile}`) }) } function toMakeGiffuc() { let e = ChoiceIsYour(); return $("#closeModal").click(), validate(e.gifText) ? t() : "" === e.gifText ? t() : alert("danger", "Invalid"); function t() { gifshot.createGIF({ gifWidth: 200, gifHeight: 200, video: tempData, interval: .1, numFrames: 10, frameDuration: 1, text: e.gifText, fontWeight: "normal", fontSize: e.fontSize + "px", fontFamily: "sans-serif", fontColor: e.fontColor, textAlign: "center", textBaseline: "bottom", sampleInterval: 10, numWorkers: 2 }, function (t) { if (tempData = e = "", !t.error) { $("#forVideoGrid").empty(); let e = t.image, n = document.createElement("img"); n.src = e, n.setAttribute("class", "recorderVideoStream"), tempData = e; let o = makeDiv("toSendGif"); return $("#forVideoGrid").append(n), $("#forVideoGrid").append(o), closeVideoFromStream = document.getElementById("closeVideoFromStream"), toSendGif = document.getElementById("toSendGif"), basicCallfucTwo() } alert("danger", `${t.error}`) }) } } async function toSendGiffuc() { return closeVideoFromStream = toSendGif, toMakeGif = void 0, await socket.emit("blob", { blob: tempData, handle: cName, type: "image/gif", sending: "gif" }), alert("success", "Gif is sent"), $("#forVideoGrid").empty(), tempData = "", stopMediaTracks(currentStream) } async function toSendPhotofuc() { return closeVideoFromStream = toSendPhoto = void 0, await socket.emit("blob", { blob: tempData, handle: cName, type: "image/jpeg", sending: "image" }), alert("success", "Photo is sent"), $("#forVideoGrid").empty(), tempData = "", stopMediaTracks(currentStream) } async function toSendVideofuc() { return closeVideoFromStream = toSendVideo = void 0, await socket.emit("blob", { blob: tempData, handle: cName, type: tempData.type, sending: "video" }), alert("success", "Video is sent"), $("#forVideoGrid").empty(), tempData = "", stopMediaTracks(currentStream) } function closeVideoFromStreamfuc() { return closeVideoFromStream = toSendPhoto = toSendVideo = toSendGif, toRunMe = void 0, $("#forVideoGrid").empty(), tempData = "" } function toMakeModal() { return $(".Modal-Container").html('\n  <div class="ModelsClass">\n  <button type="button" id="btnHides" style="visibility: hidden;display:none"data-bs-toggle="modal" data-bs-target="#exampleModal">\n  </button>\n<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">\n  <div class="modal-dialog">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="exampleModalLabel">Gif Parameter</h5>\n        <button type="button" id="closeModal" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n      </div>\n      <div class="modal-body">\n        <div class="mb-3">\n          <label for="gifText">GIF Text</label>\n          <input name="gifText" id="gifText" class="form-control" value="" size="30" placeholder="Add text here..."></input>\n        </div>\n        \n        <div class="mb-3">\n          <label for="fontSize" class="form-label">Font Size</label>\n          <input name="fontSize" id="fontSize" class="form-control" value="16" size="5" type="number"></input>\n        </div>\n\n        <div class="mb-3">\n        <label for="fontColor">Font Color</label>\n        <input type="color" name="fontColor" id="fontColor" class="form-control" value="#FFFFFF" size="5"></input>\n        </div>\n        \n      </div>\n      <div class="modal-footer" id="toRunMe">\n        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n        <button type="button" class="btn btn-primary">Save</button>\n      </div>\n    </div>\n  </div>\n</div>\n</div>\n  '), toRunMe = document.getElementById("toRunMe") } function basicCall() { return void 0 !== closeVideo && closeVideo.addEventListener("click", closeVideofuc), void 0 !== takeSnap && takeSnap.addEventListener("click", takeSnapfuc), void 0 !== videoRecorder && videoRecorder.addEventListener("click", videoRecorderfuc), toMakeModal() } function runButtonfuc() { return $("#btnHides").click() } function basicCallfucTwo() { void 0 !== toSendVideo && toSendVideo.addEventListener("click", toSendVideofuc), void 0 !== toSendGif && toSendGif.addEventListener("click", toSendGiffuc), void 0 !== toMakeGif && toMakeGif.addEventListener("click", runButtonfuc), void 0 !== toRunMe && toRunMe.addEventListener("click", toMakeGiffuc), void 0 !== toSendPhoto && toSendPhoto.addEventListener("click", toSendPhotofuc), void 0 !== closeVideoFromStream && closeVideoFromStream.addEventListener("click", closeVideoFromStreamfuc), closeVideo = takeSnap = videoRecorder = void 0 } function makeDiv(e) { return document.createElement("div").innerHTML = `<div class="option_controls">\n            <div class="options" >\n              <i class="fas fa-times" id="closeVideoFromStream"></i>\n            </div>\n            <div class="options" id="${e}">\n            <i class="far fa-paper-plane"></i>\n            </div>\n          </div>` } function makeDivForGif(e, t) { return document.createElement("div").innerHTML = `<div class="option_controls">\n            <div class="options" >\n              <i class="fas fa-times" id="closeVideoFromStream"></i>\n            </div>\n            <div class="options" id="${e}">\n            <i class="far fa-paper-plane"></i>\n            </div>\n            <div class="options" id="${t}">\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="30" height="30">\n      <path fill="currentColor" d="M13.177 12.013l-.001-.125v-.541-.512c0-.464 0-.827-.002-1.178a.723.723 0 0 0-.557-.7.715.715 0 0 0-.826.4c-.05.115-.072.253-.073.403-.003 1.065-.003 1.917-.002 3.834v.653c0 .074.003.136.009.195a.72.72 0 0 0 .57.619c.477.091.878-.242.881-.734.002-.454.003-.817.002-1.633l-.001-.681zm-3.21-.536a35.751 35.751 0 0 0-1.651-.003c-.263.005-.498.215-.565.48a.622.622 0 0 0 .276.7.833.833 0 0 0 .372.104c.179.007.32.008.649.005l.137-.001v.102c-.001.28-.001.396.003.546.001.044-.006.055-.047.081-.242.15-.518.235-.857.275-.767.091-1.466-.311-1.745-1.006a2.083 2.083 0 0 1-.117-1.08 1.64 1.64 0 0 1 1.847-1.41c.319.044.616.169.917.376.196.135.401.184.615.131a.692.692 0 0 0 .541-.562c.063-.315-.057-.579-.331-.766-.789-.542-1.701-.694-2.684-.482-2.009.433-2.978 2.537-2.173 4.378.483 1.105 1.389 1.685 2.658 1.771.803.054 1.561-.143 2.279-.579.318-.193.498-.461.508-.803.014-.52.015-1.046.001-1.578-.009-.362-.29-.669-.633-.679zM18 4.25H6A4.75 4.75 0 0 0 1.25 9v6A4.75 4.75 0 0 0 6 19.75h12A4.75 4.75 0 0 0 22.75 15V9A4.75 4.75 0 0 0 18 4.25zM21.25 15A3.25 3.25 0 0 1 18 18.25H6A3.25 3.25 0 0 1 2.75 15V9A3.25 3.25 0 0 1 6 5.75h12A3.25 3.25 0 0 1 21.25 9v6zm-2.869-6.018H15.3c-.544 0-.837.294-.837.839V14.309c0 .293.124.525.368.669.496.292 1.076-.059 1.086-.651.005-.285.006-.532.004-1.013v-.045l-.001-.46v-.052h1.096l1.053-.001a.667.667 0 0 0 .655-.478c.09-.298-.012-.607-.271-.757a.985.985 0 0 0-.468-.122 82.064 82.064 0 0 0-1.436-.006h-.05l-.523.001h-.047v-1.051h1.267l1.22-.001c.458-.001.768-.353.702-.799-.053-.338-.35-.56-.737-.561z"></path>\n    </svg>\n            </div>\n          </div>` } function forCamerafuc() { void 0 !== cameraRotate && cameraRotate.addEventListener("click", () => { $("#forVideoGrid").empty(), moreThanOne ? (moreThanOne = !1, $("#deviceId").val(cameraArr[0].deviceId), openCamera(), document.getElementById("rotate").style.animation = "mymove 4s forwards") : (moreThanOne = !0, $("#deviceId").val(cameraArr[1].deviceId), openCamera(), document.getElementById("rotate").style.animation = "mymoveback 4s forwards") }) } function validate(e) { return /^[a-zA-Z ]{2,30}$/.test(e) } function ChoiceIsYour() { return { gifText: $("#gifText").val(), fontSize: $("#fontSize").val(), fontColor: $("#fontColor").val() } } prefersDarkScheme.matches ? darkm() : lightm(), prefersDarkScheme.addListener(e => prefersDarkScheme.matches ? darkm() : lightm()), document.getElementById("msg").addEventListener("keyup", myFunction), document.getElementById("msg").addEventListener("change", bye), document.getElementById("msg").addEventListener("keyup", function (e) { 13 !== e.keyCode || document.getElementById("btn").click() }), btn.addEventListener("click", init), socket.on("CheckMe", () => { if (!cName) return location.reload() }), socket.on("basic_need", e => { keySize = e.keySize, iterations = e.iterations, password = e.password, appVersion = e.appVersion, basic_init(e.arr) }), socket.on("chat", function (e) { if (e.message.match(/sticker/i)) return $("#send").append(`<p class="dummy">${firstName(e.handle)} : ${e.url}  <em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></p>`); var t = decrypt(e.message, password); return $("#send").append(`<p class="dummy">${firstName(e.handle)} : ${t.toString(CryptoJS.enc.Utf8).toString()} <em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></p>`) }), socket.on("alert", e => ($("#alert").fadeIn(1500), $("#alert").html(`<div class="alert alert-primary" role="alert">${e.newFeature}</div>`), setTimeout(() => { $("#alert").fadeOut(1e3).empty() }, e.time))), socket.on("blob", e => { if ("audio" === e.sending) { let t = []; t.push(e.blob); let n = (window.URL || window.webkitURL).createObjectURL(new Blob(t, { type: e.type })); return $("#send").append(`<div class="dummy ">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp; <audio class="fileAudio" controls autobuffer="autobuffer"><source src="${n}"/></audio>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), t = [] } if ("video" === e.sending) { let t = []; t.push(e.blob); let n = (window.URL || window.webkitURL).createObjectURL(new Blob(t, { type: e.type })); return $("#send").append(`<div class="dummy ">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp;<video class="fileVideo" controls autobuffer="autobuffer"><source src="${n}"/></video>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), t = [] } if ("image" === e.sending) { let t = e.blob.substr(23, e.blob.length), n = makeBlob(t, e.type); return $("#send").append(`<div class="dummy">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp;<img class="imageClass" src="${n}"/>&nbsp;<a href="${n}" download><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), t = "" } if ("gif" === e.sending) { let t = e.blob.substr(22, e.blob.length), n = makeBlob(t, e.type); return $("#send").append(`<div class="dummy">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp;<img class="imageClass" src="${n}"/>&nbsp;<a href="${n}" download><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), t = "" } }), socket.on("new-user", e => { $("#newUser").append(`<p class="dummy text-info">${e}</p>`), setTimeout(() => { $("#newUser").html(" ") }, 4e3) }), socket.on("file", e => { "image" === e.tag && $("#send").append(`<div class="dummy">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp;<img class="imageClass" src="${makeBlob(e.buffer, e.type)}"/>&nbsp;<a href="${makeBlob(e.buffer, e.type)}" download="${e.fileName}"><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), "text" === e.tag && $("#send").append(`<div class="dummy addTextColor">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp;${e.fileName}&nbsp;<a href="${makeBlob(e.buffer, e.type)}" download="${e.fileName}"><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), "audio" === e.tag && $("#send").append(`<div class="dummy ">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp; <audio class="fileAudio" controls autobuffer="autobuffer"><source src="${makeBlob(e.buffer, e.type)}"/></audio>&nbsp;<a href="${makeBlob(e.buffer, e.type)}" download="${e.fileName}"><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), "video" === e.tag && $("#send").append(`<div class="dummy ">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; : &nbsp;<video class="fileVideo" controls autobuffer="autobuffer"><source src="${makeBlob(e.buffer, e.type)}"/></video>&nbsp;<a href="${makeBlob(e.buffer, e.type)}" download="${e.fileName}"><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`), "application" === e.tag && $("#send").append(`<div class="dummy addTextColor">&nbsp;<span class="nameText">${firstName(e.handle)}</span>&nbsp; :&nbsp;${e.fileName}&nbsp;<a href="${makeBlob(e.buffer, e.type)}" download="${e.fileName}"><i class="fas fa-file-download"></i></a>&nbsp;<em>${(new Date).toLocaleString("en-US", { hour: "numeric", minute: "numeric", hour12: !0 })}</em></div>`) }), socket.on("disconnect", () => { $("#send").append('<p class="dummy text-danger">User has left chat </p>') }), $(function () { socket.on("connect", function () { var e = new Delivery(socket); e.on("delivery.connect", function (e) { $("#sendfile").on("change", function (t) { var n = $("#sendfile")[0].files[0]; if (Number(maxSize) > n.size) { var o = { type: n.type ? n.type : "text/plain", tag: n.type.split("/")[0], extra: n.type.split("/").pop(), handle: cName }; e.send(n, o) } else alert("danger", `File less then ${sizeFile}`); t.preventDefault() }) }), e.on("send.success", function (e) { alert("success", "File was successfully sent") }) }) }), $(document).on("click", ".text", function () { $("#msg").val($(this).text()), $("#myUL").fadeOut() }), $(document).ready(function () { navigator.mediaDevices.enumerateDevices().then(gotDevices).then(e => { checkList(e) }) });